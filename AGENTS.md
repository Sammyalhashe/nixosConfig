# Instructions for Agents

**CRITICAL:** After *every* set of changes (file edits, creations, deletions), you MUST run:
```bash
nix flake check
```
This ensures that your changes haven't introduced any syntax errors or evaluation issues in the flake. Do not consider a task complete until this command passes successfully.

# Session State - January 11, 2026

## Status Report
**Current Task:** Fix CI/CD pipeline failures (`nix flake check` and configuration builds).
**Status:** âœ… Completed. All checks and builds are passing.

## Changes Made
1.  **Resolved `hyprlock` background conflict in `common/omarchy-config.nix`**:
    *   **Problem:** Conflict between `omarchy-nix` (Stylix) and local configuration for the Hyprlock background. Stylix required a path object, while Hyprlock required a string path.
    *   **Fix:**
        *   Used `lib.mkOverride 40` for `wallpaper_path` (kept as path object) for Stylix.
        *   Added a direct override `programs.hyprlock.settings.background.path` with `lib.mkOverride 30` (high priority) and `toString` conversion to satisfy Hyprlock's type requirement.

2.  **Resolved `host.isWsl` conflict in `hosts/oldboy/configuration.nix`**:
    *   **Problem:** Conflicting definitions for `host.isWsl` between `flake.nix` (set to `true`) and `oldboy`'s local config (set to `false`).
    *   **Fix:** Changed `hosts/oldboy/configuration.nix` to use `lib.mkDefault false`, allowing the flake configuration to take precedence.

## Verification
The following commands were successfully executed:
- `nix flake check`
- `nix build .#nixosConfigurations.homebase.config.system.build.toplevel`
- `nix build .#nixosConfigurations.homebase_omarchy.config.system.build.toplevel`
- `nix build .#nixosConfigurations.starshipwsl.config.system.build.toplevel`
- `nix build .#nixosConfigurations.homebasewsl.config.system.build.toplevel`
- `nix build .#nixosConfigurations.nixos.config.system.build.toplevel`
- `nix build .#nixosConfigurations.oldboy.config.system.build.toplevel`
- `nix build .#homeConfigurations.work.activationPackage`

---
# Agent Commands and Derivation Management (Reference)

This document outlines the commands that the agent is permitted to execute within this flake, and demonstrates how to build and test derivations.

## Building/Testing Derivations

You can build and test derivations within this flake using the `nix build` and `nix test` commands.

### Example: Building a theme configuration (from dynamic theme switching task)

To build the dark theme configuration generated by the flake:
```bash
nix build .#packages.x86_64-linux.darkThemeConfigs
```

### Example: Showing flake outputs

To list all available outputs from the flake:
```bash
nix flake show
```

## Allowed Commands (Shell)

The agent has been permitted to execute the following shell commands:

*   `mkdir`: Used for creating directories.
    *   Example: `mkdir my-new-directory`
*   `ls`: Used for listing directory contents.
    *   Example: `ls -F some-directory/`
*   `rm`: Used for removing files or directories.
    *   Example: `rm -rf my-old-directory`
*   `chmod`: Used for changing file permissions.
    *   Example: `chmod +x my-script.sh`
*   `git restore`: Used for discarding changes in the working directory.
    *   Example: `git restore some-file.nix`
*   `git clone`: Used for cloning Git repositories.
    *   Example: `git clone https://github.com/some/repo some-repo-dir`
*   `nix build`: Used for building Nix derivations.
    *   Example: `nix build .#some-package`
*   `nix flake show`: Used for displaying information about a Nix flake's outputs.
    *   Example: `nix flake show github:NixOS/nixpkgs`
*   `find`: Used for searching for files in a directory hierarchy.
    *   Example: `find . -name "*.nix"`
*   `grep`: Used for searching text within files (often implicitly used by the agent's `search_file_content` tool).
    *   Example: `grep "some-pattern" some-file.txt`